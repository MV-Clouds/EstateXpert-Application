<template>
    <div id="contianer" class="my-class">
        <div class="main_header_cls">
            <div slot="title" class="slds-media slds-media_centre header_block_css">
                <div class="sub_header_css">
                    <div>
                        <img src={portalMappingIcon} alt="Portal Icon" class="icon">
                    </div>
                    <div class="slds-p-left_xxx-small portal_mapping">
                        Portal Mapping
                    </div>
                </div>

                <button class="back_button" onclick={backToControlCenter}>Back to Control Center</button>
            </div>
            <div class="details_cls">
                <p>Portal Mapping allows you to "push" Listings to specific real estate portals all over the world. On
                    this
                    screen, you can select from a list of available portals, enter your details, and map specific fields
                    for
                    your listings. Want to request a new portal? <a href="javascript:void(0);" tabindex="0" onclick={navigateToSupportPage}>Contact us</a>.
                </p>
                <br />
                <p>For more information about this feature, <a href="#">Click here</a></p>
            </div>
        </div>
        <div class="main_body">
            <div class="main_body_cls">
                <div>
                    <div class="card-header" slot="title">
                        <div
                            class="slds-text-heading_small slds-truncate slds-text-weight_bold available_css slds-p-left_medium slds-p-right_medium tooltip_css">
                            Available Portals <lightning-helptext
                                content="Hover on a portal tile to add new mapping"></lightning-helptext>
                        </div>
                    </div>

                    <div class="grid-style available-portals slds-p-left_medium slds-p-right_medium">
                        <template for:each={portals} for:item="portal">
                            <div key={portal.id}>
                                <div class="portal-box" onmouseover={handleMouseOver} onmouseout={handleMouseOut}>
                                    <img src={portal.MVEX__Logo_URL__c} alt={portal.MasterLabel} class="portal-logo">
                                    <div class="portal-info">
                                        <div class="portal-name">{portal.MasterLabel}</div>
                                        <button class="settings" data-portalname={portal.MasterLabel}
                                            data-portaliconurl={portal.MVEX__Logo_URL__c} onclick={handleNew}>New</button>
                                    </div>
                                </div>
                            </div>
                        </template>
                    </div>
                </div>

                <div>
                    <div class="card-header" slot="title">
                        <div
                            class="slds-text-heading_small slds-truncate slds-p-left_medium slds-p-right_medium slds-text-weight_bold availale_css1">
                            Connected Portals
                        </div>
                    </div>
                    <div class="field-mapping-container">
                        <div class="tableContainer">
                            <div class="portalMapping_header-row">
                                <div class="slds-col">
                                    <p class="header-text">No.</p>
                                </div>
                                <div class="slds-col">
                                    <p class="header-text">Title</p>
                                </div>
                                <div class="slds-col">
                                    <p class="header-text">Name</p>
                                </div>
                                <div class="slds-col">
                                    <p class="header-text">Status</p>
                                </div>
                                <div class="slds-col">
                                    <p class="header-text">Action</p>
                                </div>
                            </div>
                            <div class="portalMapping_recordValues">
                                <template if:true={isPortalData}>
                                    <template for:each={portalRecordList} for:item="record" for:index="index">
                                        <div key={record.val.Id} class="portalMapping_data-row">
                                            <div class="slds-col">
                                                {record.number}
                                            </div>
                                            <div class="slds-col font_style_css">
                                                <img src={record.val.MVEX__Endpoint__c} alt={record.val.MVEX__Generator__c}
                                                    class="small-logo">
                                            </div>
                                            <div class="slds-col font_style_css">
                                                {record.val.Name}
                                            </div>
                                            <div class="slds-col">
                                                <template if:true={record.val.MVEX__Is_Active__c}>
                                                    <span class="badge">Active</span>
                                                </template>
                                                <template if:false={record.val.MVEX__Is_Active__c}>
                                                    <span class="badge-red">Inactive</span>
                                                </template>
                                            </div>
                                            <div class="slds-col">
                                                <lightning-button label="View details" data-portalname={record.val.Name}
                                                    data-portaliconurl={record.val.MVEX__Endpoint__c}
                                                    data-portalstatus={record.val.MVEX__Is_Active__c}
                                                    data-portalgen={record.val.MVEX__Generator__c}
                                                    data-portalid={record.val.Id}
                                                    onclick={handleClick}></lightning-button>
                                            </div>
                                        </div>
                                    </template>
                                </template>
                                <template if:false={isPortalData}>
                                    <div class="no_portal_css">
                                        No Portals are available to show.
                                    </div>
                                </template>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <lightning-layout>
        <template if:true={showModal}>
            <c-new-pop-up onhidepopup={handleHidePopup} get-portal-name={clickedPortalName}
                get-portal-icon-url={clickedPortalIconURL}
                onrefreshpageonhide={handleHideAndRefreshPage}></c-new-pop-up>
        </template>
    </lightning-layout>

    <template if:true={isSpinner}>
        <c-spinner-component></c-spinner-component>
    </template>

</template>